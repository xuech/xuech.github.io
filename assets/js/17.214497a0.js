(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{511:function(e,t,s){e.exports=s.p+"assets/img/1.3fedc821.png"},512:function(e,t,s){e.exports=s.p+"assets/img/2.526d76b1.png"},568:function(e,t,s){"use strict";s.r(t);var a=s(6),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"require源码解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#require源码解析"}},[e._v("#")]),e._v(" require源码解析")]),e._v(" "),a("h2",{attrs:{id:"加载模块的类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载模块的类型"}},[e._v("#")]),e._v(" 加载模块的类型")]),e._v(" "),a("ul",[a("li",[e._v("内置模块："),a("code",[e._v("require('fs')")])]),e._v(" "),a("li",[e._v("加载第三方模块："),a("code",[e._v("require('axios')")])]),e._v(" "),a("li",[e._v("加载自定义模块："),a("code",[e._v("require('./utils')")])])]),e._v(" "),a("h2",{attrs:{id:"支持文件类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支持文件类型"}},[e._v("#")]),e._v(" 支持文件类型")]),e._v(" "),a("ul",[a("li",[e._v("加载"),a("code",[e._v(".js")]),e._v("文件")]),e._v(" "),a("li",[e._v("加载"),a("code",[e._v(".json")]),e._v("文件")]),e._v(" "),a("li",[e._v("加载"),a("code",[e._v(".node")]),e._v("文件")]),e._v(" "),a("li",[e._v("加载"),a("code",[e._v(".mjs")]),e._v("文件")]),e._v(" "),a("li",[e._v("加载其他文件")])]),e._v(" "),a("h2",{attrs:{id:"思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考"}},[e._v("#")]),e._v(" 思考")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("CommonJS")]),e._v(" 模块的加载流程\n"),a("ul",[a("li",[e._v("优先加载内置模块，即使有同名文件，也会优先使用内置模块")]),e._v(" "),a("li",[e._v("不是内置模块，先去缓存找")]),e._v(" "),a("li",[e._v("缓存没有就去找对应路径的文件")]),e._v(" "),a("li",[e._v("不存在")])])]),e._v(" "),a("li",[a("code",[e._v("require")]),e._v("如何加载内置模块")]),e._v(" "),a("li",[a("code",[e._v("require")]),e._v("如何加载"),a("code",[e._v("node_modules")]),e._v("模块")]),e._v(" "),a("li",[a("code",[e._v("require")]),e._v("为什么会将非"),a("code",[e._v("js/json/node")]),e._v("文件视为js文件加载")])]),e._v(" "),a("h2",{attrs:{id:"思考-commonjs模块可以进行tree-shaking吗-为什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考-commonjs模块可以进行tree-shaking吗-为什么"}},[e._v("#")]),e._v(" 思考：commonjs模块可以进行"),a("code",[e._v("tree-shaking")]),e._v("吗？为什么？")]),e._v(" "),a("p",[a("code",[e._v("es6_modules")]),e._v(" 可以在编译时进行分析，所以它是静态模块，当然就可以\n"),a("code",[e._v("tree-shaking")]),e._v("，而commonjs模块在代码执行时才引入模块属于动态模块，它就不支持"),a("code",[e._v("tree-shaking")])]),e._v(" "),a("h2",{attrs:{id:"思考-requrie在处理文件路径是为什么是绝对路径而不是相对路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考-requrie在处理文件路径是为什么是绝对路径而不是相对路径"}},[e._v("#")]),e._v(" 思考：requrie在处理文件路径是为什么是绝对路径而不是相对路径？")]),e._v(" "),a("p",[e._v("不用文件夹下可能会有同名文件，为了保障模块的唯一性只有通过绝对路径")]),e._v(" "),a("h2",{attrs:{id:"require加载顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#require加载顺序"}},[e._v("#")]),e._v(" require加载顺序")]),e._v(" "),a("ul",[a("li",[e._v("调用"),a("code",[e._v("Module._load")]),e._v("，最终返回"),a("code",[e._v("module.exports")]),e._v(" "),a("ul",[a("li",[e._v("在"),a("code",[e._v("Module._load")]),e._v("方法中调用"),a("code",[e._v("Module._resolveFilename")])]),e._v(" "),a("li",[e._v("在"),a("code",[e._v("Module._resolveFilename")]),e._v("中调用"),a("code",[e._v("Module._findPath")]),e._v("解析文件名，并将文件名变成"),a("strong",[e._v("绝对路径")])])])]),e._v(" "),a("li",[a("code",[e._v("Module._cache")]),e._v("：是否有缓存文件")]),e._v(" "),a("li",[a("code",[e._v("new Module")]),e._v("对象，包含二个重要字段，id（文件绝对路径），exports\n"),a("ul",[a("li",[e._v("创建对象完成后，将对象缓存起来："),a("code",[e._v("Module._cache[filename] = module")])])])]),e._v(" "),a("li",[e._v("调用"),a("code",[e._v("tryModuleLoad")]),e._v("方法，执行"),a("code",[e._v("module.load(filename)")]),e._v(" 尝试加载模块")]),e._v(" "),a("li",[e._v("module.paths: 包含该文件的所有路径组成的数组")]),e._v(" "),a("li",[e._v("获取文件扩展名并根据扩展名调用对应方法"),a("code",[e._v("Module.extensions")]),e._v("（策略模式）")]),e._v(" "),a("li",[a("code",[e._v("fs.readFileSync(filename, 'utf8')")]),e._v("读取文件内容")]),e._v(" "),a("li",[e._v("调用"),a("code",[e._v("module._compile")]),e._v("方法\n"),a("ul",[a("li",[e._v("使用"),a("code",[e._v("Module.wrap")]),e._v("对文件内容进行包装")]),e._v(" "),a("li",[e._v("使用"),a("code",[e._v("vm.runInThisContext")]),e._v("方法对包装的内容进行处理得到真正的函数")])])]),e._v(" "),a("li",[e._v("将用户的内容包装到一个函数中 (function (exports,require,module. __filename,__dirname){})")])]),e._v(" "),a("p",[a("img",{attrs:{src:s(511),alt:"加载流程"}}),e._v(" "),a("img",{attrs:{src:s(512),alt:"查找包的顺序"}})]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// use ")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" add "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./add.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("找到add.js并且拿到里面的内容")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// a.js")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'123'")]),e._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" a\n")])])]),a("p",[e._v("将拿到的内容放入给定的方法中，并且返回"),a("code",[e._v("modue.exports")]),e._v("：")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v(" __filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("__dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'123'")]),e._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" a\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" modue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("这样我们在use页面其实就是下面的函数：")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" add "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v(" __filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("__dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'123'")]),e._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" a\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" modue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n\n")])])]),a("p",[e._v("这样add就是a了")]),e._v(" "),a("h2",{attrs:{id:"手写require方法《简单版》"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手写require方法《简单版》"}},[e._v("#")]),e._v(" 手写require方法《简单版》")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/xuech/requireJS",target:"_blank",rel:"noopener noreferrer"}},[e._v("Github"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);