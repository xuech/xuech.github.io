(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{514:function(t,s,a){t.exports=a.p+"assets/img/2.0.5fed2cbd.png"},573:function(t,s,a){"use strict";a.r(s);var n=a(6),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[n("img",{attrs:{src:a(514),alt:"2.0"}})]),t._v(" "),n("ol",[n("li",[t._v("createElement函数：返回一个描述vdom的js对象")]),t._v(" "),n("li",[t._v("render函数：虚拟节点转真实DOM")]),t._v(" "),n("li",[t._v("diff函数：用来比较2个vdom对象具体不同，形成一个描述对象（描述2个vdom的不同点）")]),t._v(" "),n("li",[t._v("patch函数：将差异应用到真实的 DOM 树上")])]),t._v(" "),n("h1",{attrs:{id:"vdom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vdom"}},[t._v("#")]),t._v(" "),n("code",[t._v("vdom")])]),t._v(" "),n("blockquote",[n("p",[t._v("用js模拟DOM结构，计算出最小变更，操作DOM，把DOM的操作转为JS的操作\n存在价值：数据驱动视图，控制DOM操作")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div id"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div1"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"container"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("vdom"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n转译过后的dom\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  tag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  props"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    className"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'container'")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  children"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      tag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'p'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      children"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'vdom'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"vdom-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vdom-js"}},[t._v("#")]),t._v(" "),n("code",[t._v("vdom.js")])]),t._v(" "),n("h3",{attrs:{id:"构建虚拟节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建虚拟节点"}},[t._v("#")]),t._v(" 构建虚拟节点")]),t._v(" "),n("blockquote",[n("p",[t._v("通过类的实例化将传入的dom元素信息对象化，此时就构成了虚拟节点")])]),t._v(" "),n("ul",[n("li",[t._v("createElement(type,props,children)")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//构造函数")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Element")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" children")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("children "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("children")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Element")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("children"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"转化真实节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#转化真实节点"}},[t._v("#")]),t._v(" 转化真实节点")]),t._v(" "),n("ul",[n("li",[t._v("render(vdom)")])]),t._v(" "),n("h3",{attrs:{id:"渲染dom节点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#渲染dom节点"}},[t._v("#")]),t._v(" 渲染DOM节点")]),t._v(" "),n("ul",[n("li",[t._v("renderDom(rDom, document.getElementById('app'))")])]),t._v(" "),n("h2",{attrs:{id:"diff-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diff-js"}},[t._v("#")]),t._v(" "),n("code",[t._v("diff.js")])]),t._v(" "),n("h3",{attrs:{id:"新旧阶段差异分析并获取补丁包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新旧阶段差异分析并获取补丁包"}},[t._v("#")]),t._v(" 新旧阶段差异分析并获取补丁包")]),t._v(" "),n("ul",[n("li",[t._v("使用深度优先算法进行比较\n"),n("ul",[n("li",[t._v("只比较同一层级，不跨级比较")]),t._v(" "),n("li",[t._v("tag不相同，则直接删掉重建，不再深度比较")]),t._v(" "),n("li",[t._v("tag和key都相同，则认为是相同节点，不再深度比较")])])]),t._v(" "),n("li",[t._v("得到新节点的操作记录，【增、删、改、换】")]),t._v(" "),n("li",[t._v("diff算法具体流程：\n"),n("ol",[n("li",[t._v("拿到新旧vdom")]),t._v(" "),n("li",[t._v("如果不存在新dom，则得到 'REMOVE' 类型的操作记录")]),t._v(" "),n("li",[t._v("如果不存在旧dom，则得到 'ADD' 类型的操作记录")]),t._v(" "),n("li",[t._v("如果新旧节点类型为字符串且文本不相同，则得到 'TEXT'类型的操作记录")]),t._v(" "),n("li",[t._v("如果新旧节点类型相同，通过递归调用得到所有子节点的操作记录")]),t._v(" "),n("li",[t._v("剩余则为'REPLACE'类型的替换操作记录")])])])]),t._v(" "),n("h2",{attrs:{id:"patch-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#patch-js"}},[t._v("#")]),t._v(" "),n("code",[t._v("patch.js")])]),t._v(" "),n("h3",{attrs:{id:"给创建好的真实dom打补丁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#给创建好的真实dom打补丁"}},[t._v("#")]),t._v(" 给创建好的真实dom打补丁")]),t._v(" "),n("ul",[n("li",[t._v("循环补丁包，补丁类型设置相应的操作")])]),t._v(" "),n("h2",{attrs:{id:"虚拟dom的缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#虚拟dom的缺点"}},[t._v("#")]),t._v(" 虚拟dom的缺点")]),t._v(" "),n("ul",[n("li",[t._v("首次渲染大量DOM时，由于多了一层DOM计算，会比原生innerHTML方法插入慢")]),t._v(" "),n("li",[t._v("虚拟DOM需要在内存中维护一份DOM的副本")]),t._v(" "),n("li",[t._v("适合频繁DOM更新的场景")])]),t._v(" "),n("h2",{attrs:{id:"问-为什么-vue-中不要用-index-作为-key"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问-为什么-vue-中不要用-index-作为-key"}},[t._v("#")]),t._v(" 问：为什么 Vue 中不要用 index 作为 key")]),t._v(" "),n("ul",[n("li",[t._v("diff算法中通过tag和key判断是否是sameNode")]),t._v(" "),n("li",[t._v("减少渲染次数，提升渲染性能")])]),t._v(" "),n("p",[t._v("代码在GitHub: "),n("a",{attrs:{href:"https://github.com/xuech/vue-vdom",target:"_blank",rel:"noopener noreferrer"}},[t._v("源码"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.cn/post/6877142396967223304",target:"_blank",rel:"noopener noreferrer"}},[t._v("个人"),n("OutboundLink")],1),t._v(" "),n("a",{attrs:{href:"https://juejin.cn/post/6844904078196097031",target:"_blank",rel:"noopener noreferrer"}},[t._v("全面"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);